services:
  - type: web
    name: ecom-storage
    env: docker
    region: oregon
    plan: free
    dockerfile: ./Dockerfile
    
    # Pre-deployment commands
    preDeployCommand: |
      # Create .env file if it doesn't exist
      if [ ! -f .env ]; then
        cp .env.example .env
      fi

envVars:
  - key: PORT
    value: "80"
  - key: DB_HOST
    generateValue: false
    value: localhost
  - key: DB_NAME
    value: ecom_storage
  - key: DB_USER
    value: root
  - key: DB_PASS
    generateValue: true
  - key: DB_CHARSET
    value: utf8mb4
  - key: APP_ENV
    value: production
  - key: APP_DEBUG
    value: "false"
  - key: APP_URL
    fromDatabase:
      name: ecom-storage
      property: url
